function s(e,t,r=""){if(e==!1)return!1;let i=document.createElement(e);for(var n in t)i.setAttribute(n,t[n]);return i.innerHTML=r,i}imagesPreview=document.getElementById("product-images-preview");var o;document.getElementById("product-form").addEventListener("submit",function(){productImagePreview.src.match(/(https?:\/\/.*\.(?:png|jpg|jpeg))/i)&&productImagePreview.src.includes(window.location.hostname)?o=productImagePreview.src:o="new_images";let e=s("input",{type:"hidden",class:"d-none",name:"selected_image",value:o});this.append(e)});imagesPreview.querySelectorAll(".product-img").forEach(e=>{e.querySelector(".btn-success").addEventListener("click",function(){productImagePreview.src=e.querySelector("img").src,imagesPreview.querySelectorAll(".product-img").forEach((t,r)=>{let i=r+1;t.querySelector("input").setAttribute("name","old_images["+i+"]")}),e.querySelector("input").setAttribute("name","old_images[0]")}),e.querySelector(".btn-danger").addEventListener("click",function(){this.parentElement.parentElement.remove()})});productImage.addEventListener("input",function(e){if(e.target.files,this.files.length>0){imagesPreview.querySelectorAll(".product-img.new").forEach(r=>{r.remove()});let t=!0;[...this.files].map((r,i)=>{t&&(t=!1,productImagePreview.src=URL.createObjectURL(r)),g(r,e)})}});$("#product_link").on("input",async function(){let e=$(this).val();h(e)});function v(e){var t=/^(https?:\/\/)?(www\.)?aliexpress\.com\/item\/\d+\.html/i;return t.test(e)}function h(e){if(!v(e)){console.error("Invalid AliExpress URL");return}$.ajax({url:proxyUrl,method:"GET",data:{url:e},success:function(t){let r=!0;t.images.map(i=>{r&&(r=!1,productImagePreview.src=i),g(i)}),$(productId).val(t.product_id),$(title).val(t.title),$(price).val(t.price),$(stock).val(t.quantity)},error:function(t,r,i){console.error("Error:",i)}})}function g(e,t=null){let r=s("div",{class:"product-img new rounded"}),i;const n=new Image;b(e)?(n.src=e,i=s("input",{value:e,name:"url_images[]",type:"hidden",class:"d-none"}),r.append(i),r.classList.add("url-image")):n.src=URL.createObjectURL(e);let u=s("div",{class:"btns"}),m=s("button",{class:"btn btn-sm btn-success",type:"button",tabindex:"-1"},"<i class='fa fa-image'></i>");m.addEventListener("click",function(){if(productImagePreview.src=n.src,t!=null){var a=Array.from(fileList);let c=a.splice(index,1);a.unshift(c[0]);var l=new DataTransfer;a.forEach(function(d){l.items.add(d)}),t.target.files=l.files}else imagesPreview.querySelectorAll(".product-img.url-image input").forEach((c,d)=>{let f=d+1;c.setAttribute("name","url_images["+f+"]")}),console.log(n),i.setAttribute("name","url_images[0]")});let p=s("button",{class:"btn btn-sm btn-danger",type:"button",tabindex:"-1"},"<i class='fa fa-trash'></i>");p.addEventListener("click",function(){if(this.parentElement.parentElement.remove(),t!=null){var a=Array.from(fileList);a.splice(index,1);var l=new DataTransfer;a.forEach(function(c){l.items.add(c)}),t.target.files=l.files,t.target.dispatchEvent(new Event("input"))}}),r.appendChild(n),u.appendChild(m),u.appendChild(p),r.appendChild(u),imagesPreview.appendChild(r)}function b(e){let t;try{t=new URL(e)}catch{return!1}return t.protocol==="http:"||t.protocol==="https:"}
