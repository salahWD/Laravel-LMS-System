const a=Stripe(stripeKey);let s;$(window).ready(function(){i(),m()});document.querySelector("#payment-form").addEventListener("submit",d);async function i(){s=a.elements({clientSecret:clientSecretKey}),s.create("payment").mount("#payment-element");const e={mode:"shipping"},r=s.create("address",e);r.mount("#address-element"),r.on("change",c=>{c.complete&&(address=c.value.address)})}async function d(t){t.preventDefault(),o(!0);const{error:e}=await a.confirmPayment({elements:s,confirmParams:{return_url:successUrl}});await s.getElement("address").getValue(),e&&(e.type==="card_error"||e.type==="validation_error"?n(e.message):n("An unexpected error occurred."),o(!1))}async function m(){const t=new URLSearchParams(window.location.search).get("payment_intent_client_secret");if(!t)return;const{paymentIntent:e}=await a.retrievePaymentIntent(t);switch(e.status){case"succeeded":n("Payment succeeded!");break;case"processing":n("Your payment is processing.");break;case"requires_payment_method":n("Your payment was not successful, please try again.");break;default:n("Something went wrong.");break}}function n(t){const e=document.querySelector("#payment-message");e.classList.remove("hidden"),e.textContent=t,setTimeout(function(){e.classList.add("hidden"),e.textContent=""},4e3)}function o(t){t?(document.querySelector("#submitBtn").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submitBtn").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}
